' Gambas class file

Public TmpAlumno As AlumnoVO
Public ControladorAplicacion As Controlador

Public Sub Form_Open()
  
  Me.Center()
  'si no esta editando, poner todos los campos "vacios"
  'me voy la primera caja de texto...
  TextBoxNOMBRE.SetFocus()
  
  'si estoy a単adiendo
  PictureBoxAlumno.tag = "icono_fotos_personas.png"
  
End

Public Sub ToolButtonCalendario_Click()
  
  Dim fcalendario As New FormCalendario
  
  Dim fecha As New ClaseDato
  
  fcalendario.fecha = fecha
  
  fcalendario.Showmodal()
  
  TextBoxFECHANACIMIENTO.text = Format(Date(Year(fecha.tag), Month(fecha.tag), Day(fecha.tag)), "dd-mmmm-yyyy")
  TextBoxFECHANACIMIENTO.tag = fecha.tag
  
End

Public Sub ToolButtonAceptar_Click()
  
  If TmpAlumno.idAlumno <> 0 Then 
    'si estoy editando...  
  Else 
    
    'si estoy a単adiendo
    TmpAlumno.idAlumno = 0
    TmpAlumno.Nombre = TextBoxNOMBRE.Text
    TmpAlumno.Apellido = TextBoxAPELLIDOS.Text
    TmpAlumno.Documento = TextBoxDOCUMENTO.Text
    TmpAlumno.Domicilio = TextBoxDOMICILIO.Text
    TmpAlumno.EscOrigen = TextBoxESCORIGEN.Text
    If TextBoxFECHANACIMIENTO.Tag = Null Then TextBoxFECHANACIMIENTO.Tag = Now
    TmpAlumno.FechaNacimiento = TextBoxFECHANACIMIENTO.Tag
    TmpAlumno.Legajo = TextBoxLEGAJO.Text
    TmpAlumno.Nacionalidad = TextBoxNACIONALIDAD.Text
    TmpAlumno.RutaFoto = PictureBoxAlumno.Tag
    TmpAlumno.Telefono = TextBoxTELEFONO.Text
    'crear minifoto...
    creaminifoto(PictureBoxAlumno.tag)
    
    If ControladorAplicacion.log.validarAnnadirAlumno(TmpAlumno) Then 
      'se ha a単adido bien el nuevo alumno
      limpio()
      Me.Close()
    Else
      Message.Error(("Se ha producido un error al intentar a単adir el nuevo alumno"))
    Endif
    
  Endif
  
End

Public Sub limpio()
  
  TextBoxNOMBRE.Text = ""
  TextBoxAPELLIDOS.Text = ""
  TextBoxDOCUMENTO.Text = ""
  TextBoxDOMICILIO.Text = ""
  TextBoxESCORIGEN.Text = ""
  TextBoxFECHANACIMIENTO.Tag = ""
  TextBoxLEGAJO.Text = ""
  TextBoxNACIONALIDAD.Text = ""
  PictureBoxAlumno.Tag = ""
  PictureBoxAlumno.Picture = Picture["icono_fotos_personas.png"]
  TextBoxTELEFONO.Text = ""
  
End

Public Sub ToolButtonCancelar_Click()
  
  limpio()
  Me.Close()
  
End

Public Sub ToolButtonfoto_Click()
  
  Dim comando As String = ControladorAplicacion.rutaTrabajo & "FotoCarnetMyWebCam.gambas"
  Dim nombrefinal As String
  
  Exec [comando] Wait
  '  User.home & "/webcam_carnet.png"
  nombrefinal = ControladorAplicacion.rutaTrabajo & "Fotos/" & Replace(Replace(Replace("webcam_carnet" & Str$(Now()) & ".png", " ", "_"), "/", "-"), ":", "-")
  
  If Exist(User.home & "/webcam_carnet.png") Then 
    Exec ["mv", User.home & "/webcam_carnet.png", nombrefinal] Wait
    
    PictureBoxAlumno.tag = File.Name(nombrefinal)
    PictureBoxAlumno.picture = Picture[nombrefinal]
  Endif
  
End

Public Sub PictureBoxAlumno_MouseDown()
  
  ModuleAsignarYSoltarImagenes.asignaImagen(PictureBoxAlumno, ControladorAplicacion.rutaTrabajo & "Fotos/")
  
End

Public Sub creaminifoto(ruta As String)
  
  Dim i As Image
  
  i = Image.Load(ruta)
  
  i = i.Stretch(30, 30)
  
  i.Save(ControladorAplicacion.rutaTrabajo & "MiniFotos/Mini" & File.Name(ruta))
  
  Return 

End

